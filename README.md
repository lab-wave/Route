# Фреймворк для моделирования и построения динамических расписаний движения больших групп агентов (в том числе автономных) в мультиагентных транспортных и логистических системах высокой плотности 
![image](https://github.com/user-attachments/assets/decbcd53-5c54-444c-a314-4185e7d59a16)

Фреймворк «Маршрут» представляет собой комплекс программных инструментов для ускоренного построения систем планирования и оптимизации траекторий движения групп автономных агентов (движущихся объектов различного типа), а также диспетчеризации потока заданий в транспортных и логистических мультиагентных системах в условиях высокой плотности. Под мультиагентной системой понимается группа интеллектуальных агентов (в том числе автономных), которые взаимодействуют друг с другом для решения задач, выходящих за рамки индивидуальных возможностей или знаний каждого агента. Каждый агент в такой системе обладает собственными задачами и сценарием функционирования, а также способен взаимодействовать с другими агентами для достижения как индивидуальных, так и коллективных задач. Такие системы используются в задачах, где действия нескольких агентов должны быть скоординированы, они могут быть кооперативными, конкурентными или сочетать в себе и то, и другое. Тематика соответствует ВТН «Искусственный интеллект» и направлениям реализации Программы создания и развития Центра НТИ (проект «Создание Фреймворка для моделирования и построения динамических расписаний движения больших групп агентов (в том числе автономных) в мультиагентных транспортных и логистических системах высокой плотности»).

# Установка
Установка не предполагается

# Требуемое ПО и зависимости

| Компонент | Назначение | Версия |
|----------|------------|--------|
| C++ | Язык реализации модулей | 17 / 20 |
| CMake | Система сборки | ≥ 3.12 |
| Qt | GUI и инфраструктура | ≥ 6.2.5 |
| Windows | Операционная система | 10+ (64-bit) |
| MSVC | Компилятор C++ | ≥ 16.8 |
| Visual Studio 2019 | Среда разработки | 16.11 |
| qt-vs-tools | Плагин Visual Studio | ≥ 3.3.0 |

## Зависимости
Проект использует следующие сторонние библиотеки с открытым исходным кодом:

- **TinyXML**
- **Eigen**

Исходные коды этих зависимостей **не включены** в данный репозиторий и должны быть добавлены вручную перед сборкой проекта.

### Структура каталогов

Перед конфигурацией проекта с помощью CMake необходимо скачать зависимости и разместить их в каталоге `3rd_party` со следующей структурой:

```text
3rd_party/
├── TinyXML/
│   ├── CMakeLists.txt
│   ├── tinyxml.h
│   ├── tinyxml.cpp
│   ├── tinyxmlparser.cpp
│   ├── tinyxmlerror.cpp
│   ├── tinystr.h
│   └── tinystr.cpp
└── Eigen/
    └── Eigen/
        ├── Core
        ├── Dense
        └── ...
```

### Где скачать

- TinyXML:  
  https://github.com/leethomason/tinyxml

- Eigen:  
  https://gitlab.com/libeigen/eigen

# Сборка
Используется система сборки CMake.
1. В CMake GUI добавьте ключевые опции: Адреса каталога для бинарных файлов и адрес исходного кода проекта;
2. Нажмите Configure - выберите компилятор.
3. Если не найден Qt пропишите путь в переменной FIND_QT6_DIR.
4. Нажмите Generate.
5. Откройте проект в Visual Studio.
6. Соберите проект в Visual Studio.

# Инструкция по запуску:
## 1. Запуск Прототипа Фреймворка «Маршрут» для оптимизации маршрутов и расписаний
   После сборки проекта запуск прототипа для решения задачи построения расписания доступен через командную строку путем вызова команды `lf_test_tsp [options]` в каталоге `bin`.
   
   При вызове команды могут быть указаны следующие параметры:
   | Параметр | Описание |
|---------|----------|
| `-n <N>` | Размер матрицы (2 ≤ N ≤ 16) |
| `-single` | Запуск в однопоточном режиме |
| `-multi <threads>` | Запуск в многопоточном режиме с указанием количества потоков |
| `-h`, `--help` | Показать доступные параметры запуска |


## 2. Запуск Прототипа Фреймворка «Маршрут» для оптимизации маршрутов и расписаний с учетом транзитных узлов

Для запуска прототипа Фреймворка «Маршрут» и решения задачи оптимизации маршрутов с учетом транзитных узлов нужно разместить необходимые данные в папке `in`, которая должна находиться в той же директории, что и исполняемый файл.

- `inGraphPoints.txt` — файл с координатами терминалов и информацией о графе
- `inPerevozki.txt` — файл, содержащий информацию о требуемых перевозках  (откуда и куда необходимо доставить груз)
        
Запуск программы осуществляется через командную строку путем вызова vlf.exe.
Прототип автоматически выполнит расчет оптимальных маршрутов с учетом транзитных узлов, используя алгоритм, оптимизирующий маршруты на основе заданных данных. После завершения работы программы в папке «out» будут созданы следующие выходные файлы:

- `Transit.txt` — файл с расписанием транзитных перевозок, включающий информацию о транзитных магистралях и схемах перевозок.
- `allReys.txt` — файл с подробной информацией о каждом рейсе, включая оптимальные пути и их длину.
- `resultReys.txt` — итоговое решение задачи с минимальной суммарной протяженностью маршрутов.
   
## 3. Графическая визуализация и статистика

На сайте https://marshrut.mipt.ru/ доступна визуализация построенных графиков и анализ выполненных решений. Для работы с визуализацией выполните следующие шаги:

1. **Регистрация на сайте**
   - Перейдите на сайт https://marshrut.mipt.ru/
   - Зарегистрируйтесь, создав учётную запись, или войдите,
     если у вас уже есть аккаунт

2. **Загрузка объектов и графика**
   - После входа в систему необходимо загрузить данные:
     - **Загрузить объекты** — выберите файл с объектами, содержащий данные
       о сущностях транспортной системы (терминалы, узлы, пути)
     - **Загрузить график** — загрузите файл с построенным графиком в формате
       JSON или XLSX, содержащий информацию о маршрутах и расписаниях агентов
       
Пример визуализации полученного решения на сайте https://marshrut.mipt.ru/
<p align="center">
<img width="974" height="349" alt="image" src="https://github.com/user-attachments/assets/a8167f3b-a010-4407-87f9-bfb036dd89fc" />
</p>

# API Фреймворка «Маршрут»

Фреймворк «Маршрут» включает набор интерфейсов, которые обеспечивают его работу с ключевыми сущностями:
- интерфейсы для работы с графами - ребрами и вершинами. Вершины графа представляют собой узлы, через которые перемещаются агенты, а ребра — пути между ними.
Для каждого ребра могут быть заданы следующие параметры: тип ребра (двунаправленное или однонаправленное), вершины начала и окончания ребра, значение веса ребра для алгоритмов построения пути, набор атрибутов ребра.
Для вершин могут быть заданы следующие параметры: уникальный идентификатор вершины, набор смежных ребер (входящих и исходящих), функции добавления ребер, набор атрибутов вершины.
- интерфейсы класса графа состояний агентов и класса агента для моделирования и работы с агентами. Класс графа состояний агентов содержит: набор вершин и ребер графа, функции диапазонов с приведением к необходимому классу и фильтрацией для ребер и вершин, набор атрибутов графа. Реализован интерфейс класса состояния агента, которая содержит функцию сравнения по времени события.
- интерфейс для класса моделирования поиска пути агентом и класс контейнера дерева, который содержит алгоритмы: поиск в ширину по потомкам заданной вершины, обход всех родителей заданной вершины, выделение всех листов дерева для заданной вершины.
- интерфейс класса симулятора, который содержит: функцию создания экземпляра графа для моделирования по описанию, функцию создания агента для моделирования по его описанию, функцию запуска моделирования с учетом оптимизации движения, функцию остановки моделирования, функцию возврата статистических параметров моделирования.
- класс статистических параметров результатов моделирования. Статистика результатов моделирования включает: временную статистику (значения статистик, вычисленные на некоторый момент времени моделирования), пространственную статистику с привязкой к моделируемому графу (значения статистик, вычисленные на момент окончания моделирования, данные могут использоваться для визуализации «тепловых карт»), общие статистики (значения статистик вычисленные на момент окончания моделирования или не зависящие от времени моделирования, могут включать слепок входных параметров).
  
Для всех основных сущностей, используемых в моделировании, разработан класс для описания их атрибутов и ограничений, позволяющий загружать данные из XML-файлов для настройки и адаптации системы. 


# Благодарности
Работа выполнена лабораторией волновых процессов и систем управления Центра компетенций НТИ на базе МФТИ по направлению "Искусственный интеллект" в рамках "дорожной карты" развития высокотехнологичного направления "Искусственный интеллект" на период до 2030 года при поддержке Фонда НТИ.

# Лицензия
Распространяется по лицензии BSD 3-Clause.
